### 一、用户信息表设计

建议表名：`user_info`

| 字段名      | 类型         | 说明       | 备注         |
| ----------- | ------------ | ---------- | ------------ |
| id          | bigint       | 主键，自增 |              |
| openid      | varchar(64)  | 微信openid | 唯一，必填   |
| phone       | varchar(20)  | 用户手机号 | 可为空       |
| email       | varchar(100) | 用户邮箱   | 可为空       |
| nickname    | varchar(50)  | 用户昵称   | 可为空       |
| create_time | datetime     | 创建时间   | 默认当前时间 |
| update_time | datetime     | 更新时间   |              |

- 用户扫码登录时，仅插入openid，其他字段后续补全。

---

### 二、用户账户额度表设计

你已有`UserAccount`表，扫码登录时自动分配3个额度，可以在业务逻辑中实现：  
- 新用户扫码登录后，插入user_info表，同时在user_account表插入一条记录，额度为3。

`user_account`表建议结构：

| 字段名      | 类型        | 说明       |
| ----------- | ----------- | ---------- |
| id          | bigint      | 主键，自增 |
| openid      | varchar(64) | 微信openid |
| quota       | int         | 剩余额度   |
| total_quota | int         | 总额度     |
| status      | tinyint     | 账户状态   |
| create_time | datetime    | 创建时间   |
| update_time | datetime    | 更新时间   |

---

### 三、用户权限表设计

#### 方案2：单独建user_role表（推荐，便于扩展）

| 字段名 | 类型        | 说明       |
| ------ | ----------- | ---------- |
| id     | bigint      | 主键       |
| openid | varchar(64) | 微信openid |
| role   | varchar(20) | 用户角色   |











流式响应：

- 调用 completions 接口

- 调用 completions 方法（通常是请求后端或大模型API），传入整理好的消息和模型类型（如 chatglm）。
- 该方法返回一个流式响应（body），用于后续逐步读取回复内容。
- 流式读取和填充机器人回复

- 通过 body.getReader() 获取流式读取器， TextDecoder 用于解码字节流。
- 创建一个新的 ReadableStream ，在 start 方法里定义异步的 push 函数，不断读取内容。
- 每次读取到内容后，解码为文本，追加到 botMessage.content 上，并通过 get().updateCurrentSession 触发前端界面刷新。
- 如果读取到特殊内容（如 "0003"），说明权限校验失败，会自动跳转到登录页。
- 循环读取直到结束

- push() 会递归调用自己，直到流读取完毕（done 为 true），此时关闭流。
# 数据库表概览

以下是数据库 `openai` 中的表结构概览：

## 表清单

| 表名             | 描述                 |
| ---------------- | -------------------- |
| `openai_order`   | 存储用户订单信息     |
| `openai_product` | 存储可购买的商品信息 |
| `user_account`   | 存储用户账户信息     |

## 表结构详情

### 1. openai_order (订单表)

| 字段                | 类型          | 描述                                                  |
| ------------------- | ------------- | ----------------------------------------------------- |
| id                  | bigint(20)    | 自增ID                                                |
| openid              | varchar(128)  | 用户ID(微信分配的唯一ID)                              |
| product_id          | int(4)        | 商品ID                                                |
| product_name        | varchar(32)   | 商品名称                                              |
| product_quota       | int(8)        | 商品额度                                              |
| product_model_types | varchar(128)  | 可用模型类型                                          |
| order_id            | varchar(12)   | 订单编号                                              |
| order_time          | datetime      | 下单时间                                              |
| order_status        | tinyint(1)    | 订单状态(0-创建完成,1-等待发货,2-发货完成,3-系统关单) |
| total_amount        | decimal(10,2) | 订单金额                                              |
| pay_type            | tinyint(1)    | 支付方式(0-微信支付)                                  |
| pay_url             | varchar(128)  | 支付地址                                              |
| pay_amount          | decimal(10,2) | 支付金额                                              |
| transaction_id      | varchar(32)   | 交易单号                                              |
| pay_status          | tinyint(1)    | 支付状态(0-等待支付,1-支付完成,2-支付失败,3-放弃支付) |
| pay_time            | datetime      | 支付时间                                              |
| create_time         | datetime      | 创建时间                                              |
| update_time         | datetime      | 更新时间                                              |

### 2. openai_product (商品表)

| 字段                | 类型          | 描述                  |
| ------------------- | ------------- | --------------------- |
| id                  | bigint(20)    | 自增ID                |
| product_id          | int(4)        | 商品ID                |
| product_name        | varchar(32)   | 商品名称              |
| product_desc        | varchar(128)  | 商品描述              |
| product_model_types | varchar(256)  | 可用模型类型          |
| quota               | int(8)        | 额度次数              |
| price               | decimal(10,2) | 商品价格              |
| sort                | int(4)        | 商品排序              |
| is_enabled          | tinyint(1)    | 是否有效(0无效,1有效) |
| create_time         | datetime      | 创建时间              |
| update_time         | datetime      | 更新时间              |

### 3. user_account (用户账户表)

| 字段          | 类型         | 描述                    |
| ------------- | ------------ | ----------------------- |
| id            | bigint(20)   | 自增ID                  |
| openid        | varchar(64)  | 用户ID(微信ID)          |
| total_quota   | int(11)      | 总量额度                |
| surplus_quota | int(11)      | 剩余额度                |
| model_types   | varchar(256) | 可用模型类型            |
| status        | tinyint(1)   | 账户状态(0-可用,1-冻结) |
| create_time   | datetime     | 创建时间                |
| update_time   | datetime     | 更新时间                |

## ER图关系

```
+----------------+       +-------------------+       +-----------------+
|  openai_order  |       |  openai_product   |       |   user_account  |
+----------------+       +-------------------+       +-----------------+
| PK: id         |       | PK: id            |       | PK: id          |
| FK: product_id |------>| product_id        |       |                 |
| FK: openid     |------>|                   |<------| openid          |
+----------------+       +-------------------+       +-----------------+
```

关系说明：
1. `openai_order` 表中的 `product_id` 关联到 `openai_product` 表中的 `product_id`
2. `openai_order` 表中的 `openid` 关联到 `user_account` 表中的 `openid`

主要业务流程：
- 用户(user_account)购买商品(openai_product)生成订单(openai_order)
- 订单支付成功后，系统会根据商品信息更新用户账户的额度